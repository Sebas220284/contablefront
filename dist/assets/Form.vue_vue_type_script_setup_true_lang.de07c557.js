import{d as j,b9 as D,E as N,k as y,aB as U,o as d,c as p,p as o,w as r,z as v,q as t,m as z,bi as q,F as _,a as h,ba as E,bb as K,bc as L,x as G,b as w,bJ as J,I as P}from"./index.1bb36a93.js";import{u as H}from"./useCrudRoleStore.0db97311.js";import{r as F,l as A,a as O}from"./validators.bb8f1929.js";import{a as m,V as c}from"./VRow.971cb494.js";import{V as B}from"./VBtn.22d55266.js";import{V as I}from"./VTextField.1b37a66e.js";import{V as R}from"./VCheckbox.b279b9c1.js";import{V as Q}from"./VForm.9a7f2cfe.js";const te=j({__name:"Form",setup(W){const l=H(),{formulario:n}=D(l),g=N(),i=y([]),f=y(),V=y(),k=async a=>{var e;l.typeAction=a,await((e=V.value)==null?void 0:e.resetValidation()),i.value=[],a!="back"&&l.keyList++},S=async()=>{var e;const a=await((e=V.value)==null?void 0:e.validate());if(a!=null&&a.valid){n.value.company_id=g.company.id;const s=await l.fetchSave(n.value);s.status===200&&k("list"),s.status===422&&(i.value=s.error)}},T=a=>{let e=n.value.permissions.findIndex(s=>s===a);console.log(e),e!=-1?(f.value=!1,n.value.permissions.splice(e,1)):n.value.permissions.push(a)},b=()=>{n.value.permissions=[];for(let a=0;a<l.arrayMenus.length;a++)for(let e=0;e<l.arrayMenus[a].permissions.length;e++)l.arrayMenus[a].permissions[e].estado="Inactivo"},$=()=>{if(f.value)b();else{n.value.permissions=[];for(let a=0;a<l.arrayMenus.length;a++)for(let e=0;e<l.arrayMenus[a].permissions.length;e++)n.value.permissions.push(l.arrayMenus[a].permissions[e].id),l.arrayMenus[a].permissions[e].estado="Activo"}};return U(async()=>{if(b(),await l.fetchDataForm(),l.roleData.id){n.value.permissions=[],await l.fetchInfoRole(l.roleData.id);for(let a=0;a<l.arrayMenus.length;a++)for(let e=0;e<l.arrayMenus[a].permissions.length;e++)for(let s=0;s<n.value.permissions.length;s++)n.value.permissions.includes(l.arrayMenus[a].permissions[e].id)&&(l.arrayMenus[a].permissions[e].estado="Activo")}}),(a,e)=>(d(),p("div",null,[o(c,null,{default:r(()=>[o(m,{cols:"12",class:"d-flex justify-content-end"},{default:r(()=>[o(B,{color:"secondary",onClick:e[0]||(e[0]=s=>k("back"))},{default:r(()=>[v(" Atras ")]),_:1})]),_:1})]),_:1}),o(Q,{ref_key:"formValidation",ref:V,"lazy-validation":""},{default:r(()=>[o(c,null,{default:r(()=>[o(m,{cols:"4"},{default:r(()=>[o(I,{maxlength:"20",rules:[t(F),t(A)(t(n).name,20),t(O)(t(n).name,8)],modelValue:t(n).name,"onUpdate:modelValue":e[1]||(e[1]=s=>t(n).name=s),"error-messages":t(i).name,label:"Nombre",onKeypress:e[2]||(e[2]=s=>t(i).name="")},null,8,["rules","modelValue","error-messages"])]),_:1}),o(m,{cols:"4"},{default:r(()=>[o(I,{rules:[t(F),t(A)(t(n).description,50)],maxlength:"50",modelValue:t(n).description,"onUpdate:modelValue":e[3]||(e[3]=s=>t(n).description=s),"error-messages":t(i).description,label:"Descripci\xF3n",onKeypress:e[4]||(e[4]=s=>t(i).description="")},null,8,["rules","modelValue","error-messages"])]),_:1})]),_:1}),o(c,null,{default:r(()=>[o(m,null,{default:r(()=>[z("span",null,[v("Todos "),o(R,{label:"Todos",modelValue:t(f),"onUpdate:modelValue":e[5]||(e[5]=s=>q(f)?f.value=s:null),onClick:e[6]||(e[6]=s=>$())},null,8,["modelValue"])])]),_:1})]),_:1}),o(c,null,{default:r(()=>[(d(!0),p(_,null,h(t(l).arrayMenus,(s,C)=>(d(),p("div",{key:C},[o(m,{cols:"3"},{default:r(()=>[o(E,{width:"215"},{default:r(()=>[o(K,null,{default:r(()=>[o(L,null,{default:r(()=>[v(G(s.title),1)]),_:2},1024),(d(!0),p(_,null,h(s.permissions,(u,x)=>(d(),w(J,{key:x},{default:r(()=>[t(g).permissions.includes(u.name)?(d(),w(R,{key:0,id:"check"+C+"-"+x,label:u.name,"true-value":"Activo","false-value":"Inactivo",value:u.estado,modelValue:u.estado,"onUpdate:modelValue":M=>u.estado=M,onClick:M=>T(u.id)},null,8,["id","label","value","modelValue","onUpdate:modelValue","onClick"])):P("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),o(c,null,{default:r(()=>[o(m,{cols:"12 d-flex justify-content-center"},{default:r(()=>[o(B,{color:"primary",onClick:e[7]||(e[7]=s=>S())},{default:r(()=>[v("Guardar")]),_:1})]),_:1})]),_:1})]),_:1},512)]))}});export{te as _};
